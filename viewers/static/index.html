<!DOCTYPE html>
<!-- <html manifest="cache.manifest"> -->
<html>

<head>
  <title>DICOM Web Viewer</title>
  <meta charset="UTF-8">
  <meta name="description" content="DICOM Web Viewer (DWV) static version">
  <meta name="keywords" content="DICOM,HTML5,JavaScript,medical,imaging,DWV">
  <link type="text/css" rel="stylesheet" href="../../css/style.css">
  <style type="text/css" >
    body { background-color: #222; color: white;
      margin: 10px; padding: 0; font-size: 80%  }
    #pageHeader h1 { display: inline-block; margin: 0; color: #fff; }
    #pageHeader a { color: #ddf; }
    #pageHeader #toolbar { display: inline-block; float: right; }
    #toolbox li:first-child { list-style-type: none; padding-bottom: 10px; margin-left: -20px; }
    #pageMain { position: absolute; height: 92%; width: 99%; bottom: 5px; left: 5px; background-color: #333; }
    #infotl { color: #333; text-shadow: 0 1px 0 #fff; }
    #infotr { color: #333; text-shadow: 0 1px 0 #fff; }
    #dropBox { margin: 20px; }
  </style>
  <link type="text/css" rel="stylesheet" href="../../ext/jquery-ui/themes/ui-darkness/jquery-ui-1.11.2.min.css">
  <!-- Third party -->
  <script type="text/javascript" src="../../ext/jquery/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="../../ext/jquery-ui/jquery-ui-1.11.2.min.js"></script>
  <script type="text/javascript" src="../../ext/flot/jquery.flot.min.js"></script>
  <script type="text/javascript" src="../../ext/pdfjs/jpx.js"></script>
  <script type="text/javascript" src="../../ext/pdfjs/util.js"></script>
  <script type="text/javascript" src="../../ext/pdfjs/arithmetic_decoder.js"></script>
  <script type="text/javascript" src="../../ext/rii-mango/lossless-min.js"></script>
  <script type="text/javascript" src="../../ext/notmasteryet/jpg.js"></script>
  <script type="text/javascript" src="../../ext/kinetic/kinetic-v5.1.1-06.10.min.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/jspdf.debug.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/jspdf.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/jspdf.min.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/libs/png_support/png.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/libs/png_support/zlib.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/plugins/addimage.js"></script>
  <script type="text/javascript" src="../../ext/jsPDF/plugins/png_support.js"></script>
  <script type="text/javascript" src="../../ext/Html2canvas/html2canvas.js"></script>


  <!-- Local -->
  <script src="../../ext/kinetic/kinectic-loader.js"></script>
  <script type="text/javascript" src="../../src/app/application.js"></script>
  <script type="text/javascript" src="../../src/app/toolboxController.js"></script>
  <script type="text/javascript" src="../../src/app/viewController.js"></script>
  <script type="text/javascript" src="../../src/app/state.js"></script>
  <script type="text/javascript" src="../../src/dicom/dicomParser.js"></script>
  <script type="text/javascript" src="../../src/dicom/dictionary.js"></script>
  <script type="text/javascript" src="../../src/gui/browser.js"></script>
  <script type="text/javascript" src="../../src/gui/filter.js"></script>
  <script type="text/javascript" src="../../src/gui/generic.js"></script>
  <script type="text/javascript" src="../../src/gui/help.js"></script>
  <script type="text/javascript" src="../../src/gui/html.js"></script>
  <script type="text/javascript" src="../../src/gui/layer.js"></script>
  <script type="text/javascript" src="../../src/gui/loader.js"></script>
  <script type="text/javascript" src="../../src/gui/style.js"></script>
  <script type="text/javascript" src="../../src/gui/tools.js"></script>
  <script type="text/javascript" src="../../src/gui/undo.js"></script>
  <script type="text/javascript" src="../../src/image/filter.js"></script>
  <script type="text/javascript" src="../../src/image/geometry.js"></script>
  <script type="text/javascript" src="../../src/image/image.js"></script>
  <script type="text/javascript" src="../../src/image/luts.js"></script>
  <script type="text/javascript" src="../../src/image/reader.js"></script>
  <script type="text/javascript" src="../../src/image/view.js"></script>
  <script type="text/javascript" src="../../src/io/file.js"></script>
  <script type="text/javascript" src="../../src/io/url.js"></script>
  <script type="text/javascript" src="../../src/math/bucketQueue.js"></script>
  <script type="text/javascript" src="../../src/math/point.js"></script>
  <script type="text/javascript" src="../../src/math/scissors.js"></script>
  <script type="text/javascript" src="../../src/math/shapes.js"></script>
  <script type="text/javascript" src="../../src/math/stats.js"></script>
  <script type="text/javascript" src="../../src/tools/draw.js"></script>
  <script type="text/javascript" src="../../src/tools/editor.js"></script>
  <script type="text/javascript" src="../../src/tools/ellipse.js"></script>
  <script type="text/javascript" src="../../src/tools/filter.js"></script>
  <script type="text/javascript" src="../../src/tools/info.js"></script>
  <script type="text/javascript" src="../../src/tools/line.js"></script>
  <script type="text/javascript" src="../../src/tools/livewire.js"></script>
  <script type="text/javascript" src="../../src/tools/protractor.js"></script>
  <script type="text/javascript" src="../../src/tools/rectangle.js"></script>
  <script type="text/javascript" src="../../src/tools/roi.js"></script>
  <script type="text/javascript" src="../../src/tools/scroll.js"></script>
  <script type="text/javascript" src="../../src/tools/toolbox.js"></script>
  <script type="text/javascript" src="../../src/tools/undo.js"></script>
  <script type="text/javascript" src="../../src/tools/windowLevel.js"></script>
  <script type="text/javascript" src="../../src/tools/zoomPan.js"></script>
  <script type="text/javascript" src="../../src/utils/string.js"></script>

  <!-- Launch the app -->
  <script type="text/javascript" src="appgui.js"></script>
  <script type="text/javascript" src="applauncher.js"></script>


  <style>


    #container {width:820px;height:100px;overflow:hidden;}
    #container.rotate90,#container.rotate270 {width:100px;height:820px}
    #image {
      transform-origin: top left; /* IE 10+, Firefox, etc. */
      -webkit-transform-origin: top left; /* Chrome */
      -ms-transform-origin: top left; /* IE 9 */
    }
    #container.rotate90 #image {
      transform: rotate(90deg) translateY(-100%);
      -webkit-transform: rotate(90deg) translateY(-100%);
      -ms-transform: rotate(90deg) translateY(-100%);
    }
    #container.rotate180 #image {
      transform: rotate(180deg) translate(-100%,-100%);
      -webkit-transform: rotate(180deg) translate(-100%,-100%);
      -ms-transform: rotate(180deg) translateX(-100%,-100%);
    }
    #container.rotate270 #image {
      transform: rotate(270deg) translateX(-100%);
      -webkit-transform: rotate(270deg) translateX(-100%);
      -ms-transform: rotate(270deg) translateX(-100%);
    }




    body {


      -moz-border-radius: 10px;
      border-radius: 10px;

      -moz-transition: all 200ms linear;
      -webkit-transition: all 200ms linear;
      -o-transition: all 200ms linear;
      transition: all 200ms linear;
      float: right;
    }


    .drop_hover {
      -moz-box-shadow: 0 0 30px rgba(31, 65, 46, 0.8) inset;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.8) inset;
    }

    .draggable {
      display: inline-block;
      margin: 20px 10px 10px 20px;
      padding-top: 20px;
      width: 80px;
      height: 40px;
      /*color: #3D110F;
      background-color: #822520;
      border: 4px solid #3D110F;
      text-align: center;*/
      font-size: 2em;
      cursor: move;

      -moz-transition: all 200ms linear;
      -webkit-transition: all 200ms linear;
      -o-transition: all 200ms linear;
      transition: all 200ms linear;

      -moz-user-select: none;
      -khtml-user-select: none;
      -webkit-user-select: none;
      user-select: none;

    }
  </style>

</head>

<body id="body" ondblclick="showCoords(event)">

<div id="pageHeader">

  <!-- Title -->
  <h1>DICOM Web Viewer
    (<a href="https://github.com/ivmartel/dwv">dwv</a>
    <span class="dwv-version"></span>)</h1>

  <!-- Toolbar -->
  <div id="toolbar"></div>

</div><!-- /pageHeader -->

<div id="pageMain">

  <!-- Open file -->
  <div id="openData" title="File">
    <div id="loaderlist"></div>
    <div id="progressbar"></div>
  </div>

  <!-- Toolbox -->
  <div id="toolbox" title="Toolbox">
    <ul id="toolList"></ul>
  </div>

  <!-- History -->
  <div id="history" title="History"></div>

  <!-- Tags -->
  <div id="tags" title="Tags"></div>

  <!-- Help -->
  <div id="help" title="Help"></div>



  <p><input type="button" id="reset" value="reset" style  ="float: right"  /></p>

  <p><input type="button" id="button1" value = "deplacement " style  ="float: right; z-index: 1000"   /></p>
  <p><input type="button" id="button2" value = "rotate" style  ="float: right; z-index: 1000 "/></p>
  <p><input type="button" id="button3" value = "snap " style  ="float: right; z-index: 1000"   /></p>
  <p><input type="button" id="button4" value = "Export PDF" style  ="float: right; z-index: 1000"   /></p>
  <p><select id="list" style="float: right">
              <option>Sélectionnez votre implant</option>
              <option>Implant test1</option>
              <option>Implant test2</option>
              <option>Implant test3</option>
              <option>Implant test4</option>

  </select>
  </p>
  <p><select id="list2" style="float: right">
              <option>Sélectionnez votre patient</option>
              <option>DUPOND Jacques</option>
              <option>CHARLES Adrien</option>
  </select>
  </p>

  <div class="drag" style="float: right">



    <!--<img id ='img' src="images/test.jpg" class="draggable" style="width:80px; height:40px; z-index: 500" />
    <img src="images/Implant_dimensionne.png" class="draggable" style= " width:auto; height:auto ; z-index: 500" />-->
    <script type="text/javascript " src="rotate.js"> </script>
    <script src="http://yui.yahooapis.com/3.2.0/build/yui/yui-min.js"></script>

    <script>



      // taille de l'ecran
      console.log("Body taille ",window.innerWidth  ,window.innerHeight  );
      // coordonnée de la sourie
      function showCoords(event) {
        var x = event.clientX;
        var y = event.clientY;
        console.log(x,"^^",y);
      // Début de la fonction principale
      }
      $(function() {

          // Fonction pour rendre un élément draggable
        function dragger (value){
          $( ".draggable2" ).draggable({
            disabled: value
          });

          $( ".draggable2" ).draggable( "option", "disabled", value );
          $("body").droppable({
            accept: ".draggable"
          });
          $(".draggable2").draggable({
            revert: 'invalide'
          });

        }
        // on séléctionne un immplant après on procède au traitement
        

        var list = document.getElementById('list');
         list.addEventListener('change', function() {

           var canvas1 = document.getElementById("canvas");
           canvas1.style.zIndex = "500" ;
           var canvas2 = document.getElementById("dwv-imageLayer") ;
           canvas2.zIndex = "80" ;
///////////////////////////////////////////////////////////Test console ///////////////////////////////////////////////////////////////
           // Fonction pour tester le bon fonctionnement des cookies afin de recuperer width and height de l'image
           function readCookie(name) {
             var nameEQ = name + "=";
             var ca = document.cookie.split(';');
             for(var i=0;i < ca.length;i++) {
               var c = ca[i];
               while (c.charAt(0)==' ') c = c.substring(1,c.length);
               if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
             }
             return null;
           }
           var width= parseInt(readCookie("width"));
           var height= parseInt(readCookie("height"));
           console.log("this the lol  image size : ", width,height);
           console.log("this is the dimension of canvas 2 ",canvas2.width,canvas2.height);
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
          var id_liste = list.selectedIndex ;
          // On affiche le contenu de l'élément <option> ciblé par la propriété selectedIndex
          console.log(list.options[list.selectedIndex].innerHTML);
          console.log("id réelle liste ", id_liste);
        // récupération de l'implant séléctionner via Ajax et getimplant.php

           function geturlimplant(){
             var id = id_liste;
             var xhr;
             if (window.XMLHttpRequest) {
               xhr = new XMLHttpRequest();
             }
             else if (window.ActiveXObject)
             {
               xhr = new ActiveXObject("Microsoft.XMLHTTP");
             }
             //on définit l'appel de la fonction au retour serveur
             xhr.open("GET", "getimplant.php", false);
             xhr.send(null);
             xhr.responseText;
             var docXML= xhr.responseXML;
             var id_implant = docXML.getElementsByTagName("id");
             var url = docXML.getElementsByTagName("url");
             for ( var i = 0;i< id_implant.length; i++)
             {
               if (id == id_implant.item(i).firstChild.data)
               {
                 var url_ultime =  url.item(i).firstChild.data;
               }
             }
             return url_ultime;
           }
           var canvas = document.getElementById("canvas");
             var canvasWidth = 900;
             var canvasHeight = 800;
             canvas.width = canvasWidth;
             canvas.height = canvasHeight;
           var ctx = canvas.getContext("2d");
           console.log(ctx);

           var w;
           var h;
           var r = 0;
           var img = new Image;
           img.onload = function () {
             w = img.width ;
             h = img.height;

               ctx.save();
               ctx.clearRect(0, 0, canvas.width,canvas.height);
               ctx.translate(canvas.width/2,canvas.height/2);
               ctx.drawImage(img, 0,0 , img.width, img.height, -w / 2, -h/2 , w, h);
               ctx.restore();
           }
           img.src = geturlimplant();

    /// fonction pour le chargement de l'image et le dessin du petit rectangle bleu pour la rotation

           /*function draw() {
             ctx.clearRect(0, 0, canvas.width,canvas.height);
             drawRotationHandle(false);
             drawRect();
           }
           function drawRect() {
             ctx.save();
             ctx.translate(0,0);
             ctx.rotate(r);
             ctx.drawImage(img, 0, 0, img.width, img.height);
             ctx.restore();
           }
           function drawRotationHandle(withFill) {
             ctx.save();
             //ctx.translate(0, 0);
             ctx.translate(canvas.width/2,canvas.height/2);
             ctx.rotate(r);
             ctx.beginPath();
             ctx.moveTo(0, -1);
             ctx.lineTo(w / 2 + 20, -1);
             ctx.lineTo(w / 2 + 20, -7);
             ctx.lineTo(w / 2 + 30, -7);
             ctx.lineTo(w / 2 + 30, 7);
             ctx.lineTo(w / 2 + 20, 7);
             ctx.lineTo(w / 2 + 20, 1);
             ctx.lineTo(0, 1);
             ctx.closePath();
             if (withFill) {
               ctx.fillStyle = "blue";
               ctx.fill();
             }*/
             ctx.restore();

                 dragger(false);
      /////////////////////////////////////////////////////////////////////////////////Button 1 déplacer ///////////////////////////////////////////////////////
           /// Opération sur le button 1 déplacement
           var element = document.getElementById("button1");
           element.addEventListener('click', function(){
               // Récupération de l'offset en jquery

             var canvasOffset = $("#canvas").offset();
               // Offset permet d'enregistrer le déplacement
             var offsetX = canvasOffset.left ;
             var offsetY = canvasOffset.top   ;
             console.log(offsetX," je suis l'offset   ",offsetY);
              /* canvas.width = canvasWidth;
               canvas.height= canvasHeight;*/
             dragger(false);
            /* var canvas = document.getElementById("canvas");
             var ctx = canvas.getContext("2d");*/
             ctx.restore();




           },false)
////////////////////////////////////////////////////////////////////////////////////Button2 rotate//////////////////////////////////////////////////////////
           // opération sur le button 2 rotate
           var element2 = document.getElementById("button2");
           element2.addEventListener('click', function(){
             // désactiver le mode draggable
             dragger(true);
               canvas.width = canvasWidth;
               canvas.height= canvasHeight;
        /*     var canvas = document.getElementById("canvas");
             var ctx = canvas.getContext("2d");*/
             var canvasOffset = $("#canvas").offset();
             var offsetX = canvasOffset.left;
             var offsetY = canvasOffset.top;
             var isDown = false;
             var cx = canvas.width /2 ;
             var cy = canvas.height / 2;
             var w;
             var h;
             var r = 0;
               w = img.width;
               h = img.height ;
               draw();
               var canvasOffset = $("#canvas").offset();
               // Offset permet d'enregistrer le déplacement
               var offsetX = canvasOffset.left ;
               var offsetY = canvasOffset.top   ;
             function draw() {
               ctx.clearRect(0, 0, canvas.width, canvas.height);
               drawRotationHandle(true);
               drawRect();
             }
             function drawRect() {
               ctx.save();
              //ctx.translate(img.width/2, img.height/2);
              ctx.translate(canvas.width/2 , canvas.height/2)
               //  ctx.translate( offsetX,offsetY);
               ctx.rotate(r);
               ctx.drawImage(img, 0,0 , img.width, img.height, -w / 2, -h/2 , w, h);
               ctx.restore();
             }
             function drawRotationHandle(withFill) {
               ctx.save();
               ctx.translate(canvas.width/2 , canvas.height/2);
               ctx.rotate(r);
               ctx.beginPath();
               ctx.moveTo(0, 1);
               ctx.lineTo(w / 2 + 10, -1);
               ctx.lineTo(w / 2 + 10, -7);
               ctx.lineTo(w / 2 + 20, -7);
               ctx.lineTo(w / 2 + 20, 7);
               ctx.lineTo(w / 2 + 10, 7);
               ctx.lineTo(w / 2 + 10, 1);
               ctx.lineTo(0, 1);
               ctx.closePath();
               if (withFill) {
                 ctx.fillStyle = "blue";
                 ctx.fill();
               }
               ctx.restore();
               ctx.save();
             }
             function handleMouseDown(e) {
               mouseX = parseInt(e.clientX - offsetX);
               mouseY = parseInt(e.clientY - offsetY);
               drawRotationHandle(false);
               isDown = ctx.isPointInPath(mouseX, mouseY);
               console.log(isDown);
             }
             function handleMouseUp(e) {
               isDown = false;
             }
             function handleMouseOut(e) {
               isDown = false;
             }
             function handleMouseMove(e) {
               if (!isDown) {
                 return;
               }
               mouseX = parseInt(e.clientX - offsetX);
               mouseY = parseInt(e.clientY - offsetY);
               var dx = mouseX - cx;
               var dy = mouseY - cy;
               r = Math.atan2(dy, dx);
               draw();
             }
             $("#canvas").mousedown(function (e) {
               handleMouseDown(e);
             });
             $("#canvas").mousemove(function (e) {
               handleMouseMove(e);
             });
             $("#canvas").mouseup(function (e) {
               handleMouseUp(e);
             });
             $("#canvas").mouseout(function (e) {
               handleMouseOut(e);
             });
           },false)
///////////////////////////////////////////////////////// Button 3 Snap //////////////////////////////////////////////////////////////////////////////////
           ///  3eme button pour snap ( positionnement auto )
           var element = document.getElementById("button3");
           element.addEventListener('click', function(){

            // Fonction qui permet de récuperer l'id maximum de getdata et qui correspond à (x,y) du centre de l'axe du trapèze
             function MaxId()
             {
               var xhr;
                 canvas.width = canvasWidth;
                 canvas.height= canvasHeight;
               if (window.XMLHttpRequest) {
                 xhr = new XMLHttpRequest();
               }
               else if (window.ActiveXObject)
               {
                 xhr = new ActiveXObject("Microsoft.XMLHTTP");
               }
               //on définit l'appel de la fonction au retour serveur

               xhr.open("GET", "getdata.php", false);
               xhr.send(null);
               xhr.responseText;
               var docXML= xhr.responseXML;
               var a = docXML.getElementsByTagName("x");
               var b = docXML.getElementsByTagName("y");
               var  X = a.item(0).firstChild.data;
               var Y  = b.item(0).firstChild.data;
               console.log("this the max id coordonnée",X,Y);
              // function showCoords(event) {
             /*  canvas.width = canvas.width *2 ;
               canvas.height = canvas.height *2 ;*/


               var imagelayer = document.getElementById("dwv-imageLayer") ;
               function readCookie(name) {
                 var nameEQ = name + "=";
                 var ca = document.cookie.split(';');
                 for(var i=0;i < ca.length;i++) {
                   var c = ca[i];
                   while (c.charAt(0)==' ') c = c.substring(1,c.length);
                   if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
                 }
                 return null;
               }
               var width= readCookie("width");
               var height= readCookie("height");
               var coord_global_x = ( X * imagelayer.width) /width ;
               var coord_global_y = ( Y * imagelayer.height ) / height;
               // Démonstration
           /*    var houss1 = ( X * 1078) /3264 ;
               var houss2 = ( Y * 806) / 2448;*/
              /* var canvas = document.getElementById("canvas");
               var ctx = canvas.getContext("2d");*/
               ctx.save();
                 canvas.widh = canvas.width * 2;
                 canvas.height= canvas.height*2;
               ctx.clearRect(0, 0, canvas.width, canvas.height);
               ctx.translate(coord_global_x-90,coord_global_y);
               ctx.drawImage(img, 0,0, img.width, img.height, -w / 2, -h / 2, w, h);
               ctx.restore();
               //
                console.log("les cooordonéées " , coord_global_x,coord_global_y);
                console.log("imgage taille", img.width, "   ", img.height);
                 dragger(false);
               //}
             };
             MaxId();
           },false)
        }, true);
///////////////////////////////////////////////////////////////Select Patients////////////////////////////////////////////
        var list2 = document.getElementById('list2');
        list2.addEventListener('change',function()
        {
          var idListe2=list2.selectedIndex;
//////////////////////////////////////////////////////////////Button 4 "Export PDF"//////////////////////////////////////
          var element4=document.getElementById("button4");
           element4.addEventListener('click',function()
            {
              function getPatient(idPatient)
              {
                console.log(idPatient);
                var xhr;
                if (window.XMLHttpRequest) 
                  {
                    xhr = new XMLHttpRequest();
                  } 
                else 
                  if (window.ActiveXObject)
                  {
                    xhr=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xhr.open("GET", "GetPatient.php", false);
                xhr.send(null);
                xhr.responseText;
                var docXML=xhr.responseXML;
                var idPatientBDD=docXML.getElementsByTagName("ID");
                var nomPatientBDD=docXML.getElementsByTagName("Nom");
                var prenomPatientBDD=docXML.getElementsByTagName("Prenom");
                var vitalePatientBDD=docXML.getElementsByTagName("NVitale");

                for (var i = 0; i < idPatientBDD.length; i++) 
                {
                  if (idPatient==idPatientBDD.item(i).firstChild.data) 
                    {
                      var nomPatientFinal = nomPatientBDD.item(i).firstChild.data;
                      var prenomPatientFinal = prenomPatientBDD.item(i).firstChild.data;
                      var vitalePatientFinal = vitalePatientBDD.item(i).firstChild.data;
                    };                    
                };
                return nomPatientFinal+"_"+prenomPatientFinal+"_"+vitalePatientFinal;
              }

              function ExportPDF()
              {
                var imageLayer = document.getElementById("dwv-imageLayer");
                var canvasLayer = document.getElementById("canvas");

                var wImageLayer=imageLayer.width;
                var hImageLayer=imageLayer.height;
                console.log("image size ",wImageLayer,"   ",hImageLayer);

                var wCanvasLayer=canvasLayer.width;
                var hCanvasLayer=canvasLayer.height;
                console.log("Canvas size ",wCanvasLayer,"   ",hCanvasLayer);

                var imageData=imageLayer.toDataURL("image/jpeg");
                var canvasData=canvasLayer.toDataURL("image/png");

                var docPDF = new jsPDF();
                var idPatientLocal = idListe2;
                var patientBDD=getPatient(idPatientLocal);
                var patient=patientBDD.split('_');
                console.log(imageData);
                docPDF.setFontSize(20);
                docPDF.text(15,30,"Nom : "+patient[0]);
                docPDF.text(15,40,"Pénom : "+patient[1]);
                docPDF.text(15,50,"Numéro de carte vitale : "+patient[2]);
                console.log("Nom : "+patient[0]);
                console.log("Pénom : "+patient[1]);
                console.log("Numéro de carte vitale : "+patient[2]);
                docPDF.addImage(imageData,'JPEG', 15, 60, 180, ((180*hImageLayer)/wImageLayer));
                docPDF.addPage();
                docPDF.addImage(imageData,'JPEG', 15, 60, 180, ((180*hImageLayer)/wImageLayer));
                docPDF.addImage(canvasData,'PNG', 15, 60, 180, ((180*hCanvasLayer)/wCanvasLayer));
                //docPDF.addImage(canvasData,'PNG', (15-(((wCanvasLayer-wImageLayer)*180)/wImageLayer)), (60-(((wCanvasLayer-wImageLayer)*((180*hCanvasLayer)/wCanvasLayer)))/wImageLayer), 180, ((180*hCanvasLayer)/wCanvasLayer));
                docPDF.save(patient[0]);

              };
              ExportPDF();
            },false)

        },true)

      });


    </script>



  </div>

  <!-- Layer Container -->
  <div id="layerDialog" title="Image" style="z-index: 10 ">
    <div id="dwv-dropBox" class="dropBox" ></div>
    <div id="dwv" class="layerContainer">
      <div class="drop" style="z-index: 1">
        <canvas id="canvas"  class="draggable2" width= 900px height= 800px  style="  position : absolute" ></canvas>
        <canvas id="dwv-imageLayer" class="imageLayer" style="position: absolute">Only for HTML5 compatible browsers...</canvas>
      </div>

      <div id="dwv-drawDiv" class="drawDiv"></div>
      <div id="dwv-infoLayer" class="infoLayer">
        <div id="dwv-infotl" class="infotl"></div>
        <div id="dwv-infotr" class="infotr"></div>
        <div id="dwv-infobl" class="infobl"></div>
        <div id="dwv-infobr" class="infobr"><div id="dwv-plot" class="plot"></div>
        </div>
      </div><!-- /infoLayer -->
    </div><!-- /layerContainer -->
  </div><!-- /layerDialog -->



</div>


</div><!-- /pageMain -->




</body>
</html>
